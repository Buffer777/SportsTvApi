<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Stream Player</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #000; overflow: hidden; }
    .player-container { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; background: #000; }
    #player { width: 100%; height: 100%; }
    .error-message {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95); padding: 40px; border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3); text-align: center; max-width: 500px; z-index: 1000;
    }
    .error-message h2 { color: #e74c3c; margin-bottom: 16px; font-size: 24px; }
    .error-message p { color: #555; margin-bottom: 12px; line-height: 1.6; }
    .error-message code { background: #f5f5f5; padding: 12px; border-radius: 6px; display: block; margin-top: 16px; font-size: 13px; color: #333; word-break: break-all; }

    .loading { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 18px; z-index: 999; }
    .spinner { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .info-overlay { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 12px 20px; border-radius: 8px; font-size: 12px; opacity: 0; transition: opacity 0.3s ease; z-index: 100; max-width: 300px; word-break: break-all; }
    .info-overlay.show { opacity: 1; }
  </style>
</head>
<body>
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <div>Loading stream...</div>
  </div>

  <div class="player-container">
    <div id="player"></div>
  </div>

  <div id="info" class="info-overlay"></div>

  <!-- Clappr -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>

  <script>
    let player;

    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function showError(message, details = '') {
      document.getElementById('loading').style.display = 'none';
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.innerHTML = `
        <h2>⚠️ Error</h2>
        <p>${message}</p>
        ${details ? `<code>${details}</code>` : ''}
      `;
      document.body.appendChild(errorDiv);
    }

    function showInfo(text) {
      const info = document.getElementById('info');
      info.textContent = text;
      info.classList.add('show');
      setTimeout(() => info.classList.remove('show'), 3000);
    }

    function initPlayer(streamUrl) {
      try {
        player = new Clappr.Player({
          source: streamUrl,
          parentId: '#player',
          autoPlay: true,
          mute: true,        // Set true if autoplay blocked
          width: '100%',
          height: '100%',
          hideMediaControl: false,
        });

        player.on(Clappr.Events.PLAYER_READY, () => {
          document.getElementById('loading').style.display = 'none';
          showInfo('Stream loaded successfully');
        });

        player.on(Clappr.Events.PLAYER_ERROR, (err) => {
          console.error('Player error:', err);
          showError('Failed to load stream', 'Please check the URL or CORS settings');
        });

      } catch (error) {
        console.error('Initialization error:', error);
        showError('Failed to initialize player', error.message);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      const streamUrl = getUrlParameter('id');
      if (!streamUrl) {
        showError(
          'No stream URL provided',
          'Usage: dynamic.html?id=YOUR_M3U8_URL'
        );
        return;
      }

      const decodedUrl = decodeURIComponent(streamUrl);
      console.log('Loading stream:', decodedUrl);
      initPlayer(decodedUrl);
    });

    document.addEventListener('visibilitychange', () => {
      if (player && !document.hidden) {
        player.play().catch(err => console.log('Autoplay prevented:', err));
      }
    });
  </script>
</body>
</html>
